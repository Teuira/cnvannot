<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CNV Annot</title>
    <link rel="stylesheet" href="../static/css/style.css">
</head>
<body onload="browser_check()">

<input id="query_input" value="hg19:chr2:1000000-2000000:gain">
<button onclick="start_search()">Search</button>
<button onclick="reset_search()">Reset</button>

<div id="res_div"></div>

</body>
</html>

<script>

    function browser_check() {
        let isFirefox = typeof InstallTrigger !== 'undefined';
        if (isFirefox) {
            alert("Sorry, This page won't work on Firefox. Please consider using another browser!");
        }
    }

    function start_search() {
        let str_query = document.getElementById('query_input').value;

        let httpRequest = new XMLHttpRequest();
        httpRequest.timeout = 120000;
        httpRequest.responseType = 'json';
        httpRequest.open('GET', '/search/' + str_query, true);
        httpRequest.onreadystatechange = function () {
            if (httpRequest.readyState === XMLHttpRequest.DONE) {
                let status = httpRequest.status;
                if (status === 0 || (status >= 200 && status < 400)) {
                    // OK
                    show_res(httpRequest.response);
                } else {
                    // ERROR
                    alert("Sorry, Something went wrong!");
                }
            }
        };
        httpRequest.send();
    }

    function show_res(annotations) {
        let res_div = document.getElementById('res_div');
        res_div.innerHTML += "<br>"
        res_div.innerHTML += "<a href=" + annotations['ucsc_url'] + " target='_blank'>View on UCSC</a>"
        res_div.innerHTML += "<br>"
        res_div.innerHTML += "X-CNV score: " + annotations['xcnv_res'] + ' (' + annotations['xcnv_res_interpretation'] + ')'
        res_div.innerHTML += "<br>"
        res_div.innerHTML += "CNV Length: " + annotations['cnv_len']
        res_div.innerHTML += "<br>"
        res_div.innerHTML += "CNV Type: " + annotations['cnv_type']
        res_div.innerHTML += "<br>"
        res_div.innerHTML += "Overlaps with excluded regions: " + annotations['exc_overlaps']
        res_div.innerHTML += "<br>"
        res_div.innerHTML += "Gene overlaps (any overlap): " + annotations['gene_overlap_count']
        res_div.innerHTML += "<br>"
        res_div.innerHTML += "Morbid genes overlaps (any overlap): " + annotations['morbid_gene_overlap_count']
        res_div.innerHTML += "<br>"
        res_div.innerHTML += "DGV gold overlaps (any overlap > 1% frequency): " + annotations['dgv_gold_cnv_overlap_count']

        res_div.innerHTML += "<br>"
        res_div.innerHTML += "Interpretation: " + annotations['synth_interpretation']
        res_div.innerHTML += "<br>"
        res_div.innerHTML += "<br>"
        res_div.innerHTML += "*** The machine interpretation doesn't replace Human interpretation"
    }

    function reset_search() {
        document.getElementById('query_input').value = '';
        let res_div = document.getElementById('res_div');
        res_div.innerHTML = ''
    }
</script>